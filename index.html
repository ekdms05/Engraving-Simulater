<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê°ì¸ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      font-family: 'Malgun Gothic', sans-serif;
    }
    .background {
      background-image: url('background.png'); /* ë°°ê²½ ì´ë¯¸ì§€ */
      background-size: cover;
      width: 663px;
      height: 501px;
      position: relative;
      margin: 20px auto;
      box-shadow: 0 0 15px #000;
    }

    .slot {
      position: absolute;
      left: 17px;
      width: 170px;
      height: 45px;
      display: flex;
      align-items: center;
      background: rgba(0, 0, 0, 0.45);
      border: 2px solid transparent;
      border-radius: 6px;
      padding: 3px 10px;
      color: #ffff00;
      font-size: 12px;
      cursor: pointer;
    }

    .slot img {
      width: 48px;
      height: 48px;
      margin-right: 10px;
    }

    .slot:hover {
      background: rgba(255,255,255,0.1);
    }

    .gold  { border-color: #d8b133; }
    .red   { border-color: #db5a29; }
    .white { border-color: #ccc; }
    .blue  { border-color: #2c74c4; }
    .green { border-color: #4caf50; }

    .slot:nth-child(1) { top: 170px; } /* í™©ë£¡ */
    .slot:nth-child(2) { top: 232px; } /* ì£¼ì‘ */
    .slot:nth-child(3) { top: 290px; } /* ë°±í˜¸ */
    .slot:nth-child(4) { top: 345px; } /* ì²­ë£¡ */
    .slot:nth-child(5) { top: 400px; } /* í˜„ë¬´ */

    .engraving-buttons {
      position: absolute;
      right: 10px;
      top: 150px;
      width: 390px;
    }

    .engraving-buttons button {
      margin: 4px;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background: #333;
      color: white;
      font-size: 12px;
      cursor: pointer;
    }

    .engraving-buttons button:hover {
      background: #555;
    }

    .log {
      margin-top: 8px;
      background: rgba(0,0,0,0.5);
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #333;
      font-size: 12px;
      color: #fff;
    }
    
    .tab-buttons {
      position: absolute;
      top: -110px;
      left: 0px;
    }

    .tab-buttons button {
      margin: 2px;
      padding: 6px 10px;
      font-size: 12px;
      background: #222;
      color: white;
      border: 1px solid #555;
      border-radius: 4px;
      cursor: pointer;
    }

    .tab-buttons button.active {
      background: #666;
      font-weight: bold;
    }

    label {
      display: block;
      margin: 4px 0;
    }

    label input {
      float: right;
      width: 120px;
      text-align: right;
      margin-left: 10px;
    }
        
  </style>
</head>
<body>

<!-- ğŸ”¥ ì¸ì‚¿ë§ ë°°ë„ˆ -->
<div id="greetingBanner" style="
  width: 663px;
  margin: 10px auto 4px;
  padding: 10px;
  background: linear-gradient(to right, #1a1a1a, #333);
  color: #ffcc66;
  font-size: 14px;
  font-weight: bold;
  text-align: center;
  border-radius: 6px;
  box-shadow: 0 0 5px #000;
  border: 1px solid #555;
">
  ğŸ› ï¸ ê°ì¸, ë‹ ì§ì‘ ë‚­ë§Œì˜ ì‹œëŒ€ë¥¼ ì—´ê² ìŠµë‹ˆë‹¤ ğŸ› ï¸<br>
  í˜„ëª…í•œ ëŒ€ì¥ì¥ì´ë“¤ì˜ ìŠ¤íƒìŒ“ëŠ”ê³³ (ì „ì¿ ë¦°@ì—°) <br>
</div>

<!-- ğŸ”¥ ìƒë‹¨ ì†Œì§€ê¸ˆ í‘œì‹œ ì˜ì—­ -->
<div id="goldStatus" class="log" style="
width: 663px;
margin: 8px auto;
background: rgba(0,0,0,0.7);
font-size: 13px;
font-weight: bold;
color: #ffffcc;
text-align: center;
border: 1px solid #555;
border-radius: 6px;
padding: 6px;
white-space: pre-line;
"></div>

<!-- âœ… ì´ ë°©ì–´êµ¬ê´€í†µ í‘œì‹œ -->
<div id="totalPenetrationDisplay" style="
  width: 663px;
  margin: 8px auto;
  background: rgba(0, 0, 0, 0.7);
  font-size: 13px;
  font-weight: bold;
  color: #ccffcc;
  text-align: center;
  border: 1px solid #555;
  border-radius: 6px;
  padding: 6px;
">
  ğŸ›¡ï¸âš”ï¸ ì´ ë°©ì–´êµ¬ê´€í†µ: ê³„ì‚°ì¤‘...
</div>

<!-- ğŸ’¸ ê°€ê²© ì„¤ì • í† ê¸€ ë²„íŠ¼ -->
<div style="width: 663px; margin: 0 auto; text-align: center;">
  <button id="priceToggle" onclick="togglePriceConfig()" style="
    background: #444;
    color: #fff;
    padding: 6px 12px;
    border: 1px solid #888;
    border-radius: 6px;
    font-size: 13px;
    cursor: pointer;
    margin-top: 8px;
  ">ğŸ’¸ ë¹„ì„œ ê°€ê²© ì„¤ì • í¼ì¹˜ê¸°</button>
</div>

<div id="priceConfig" style="
  display: none;
  width: 663px;
  margin: 8px auto 12px;
  background: rgba(255,255,255,0.05);
  padding: 14px 20px;
  border: 1px solid #666;
  border-radius: 8px;
  color: #fff;
  font-size: 13px;
  box-shadow: 0 0 6px #000;
">
  <div style="display: flex;">
    <!-- ì™¼ìª½ ì»¬ëŸ¼ -->
    <div style="flex: 1; padding-right: 20px; border-right: 1px solid #555;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ›¡ï¸ ì‹  ì•ê°:</span>
        <input type="text" id="priceFlatì‹ " value="3600000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ›¡ï¸ ë³´ë¬¼ ì•ê°:</span>
        <input type="text" id="priceFlatë³´ë¬¼" value="6000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ›¡ï¸ ì „ì„¤ ì•ê°:</span>
        <input type="text" id="priceFlatì „ì„¤" value="25000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>âš”ï¸ ë„ê¹¨ë¹„ ë’·ê°:</span>
        <input type="text" id="priceAddë„ê¹¨ë¹„" value="6400000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>âš”ï¸ ë³´ë¬¼ ë’·ê°:</span>
        <input type="text" id="priceAddë³´ë¬¼" value="18000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>âš”ï¸ ì „ì„¤ ë’·ê°:</span>
        <input type="text" id="priceAddì „ì„¤" value="35000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì»¬ëŸ¼ -->
    <div style="flex: 1; padding-left: 20px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ‰ [ì‹ ìˆ˜] 1.8%:</span>
        <input type="text" id="priceAdd[ì‹ ìˆ˜]1.8" value="4600000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ‰ [ì‹ ìˆ˜] 1.5%:</span>
        <input type="text" id="priceAdd[ì‹ ìˆ˜]1.5" value="6000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ‰ [ì‹ ìˆ˜] 1.0%:</span>
        <input type="text" id="priceAdd[ì‹ ìˆ˜]1.0" value="3500000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ² í™©ë£¡ ì¼ë°˜:</span>
        <input type="text" id="priceHwangì¼ë°˜" value="80000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>ğŸ² í™©ë£¡ í¬ê·€:</span>
        <input type="text" id="priceHwangí¬ê·€" value="15000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
        <span>âœ¨ ì´ˆì›”:</span>
        <input type="text" id="priceTranscend" value="700000000" oninput="formatWithComma(this)" style="width: 100px; text-align: right;">
      </div>
    </div>
  </div>

  <!-- ë²„íŠ¼ ì˜ì—­ -->
  <div style="text-align: center; margin-top: 14px;">
    <button onclick="applyNewPrices()" style="
      background: #2c74c4;
      color: #fff;
      padding: 6px 16px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    ">ğŸ’¾ ê°€ê²© ë°˜ì˜</button>
  </div>
</div>



<div class="background">
  <div class="slot gold" onclick="selectSlot(0)">
    <img src="hwangryong.png" alt="í™©ë£¡">
    <span id="text0">ë´‰ì¸ëœ ë¬¸ì–‘</span>
  </div>
  <div class="slot red" onclick="selectSlot(1)">
    <img src="juzak.png" alt="ì£¼ì‘">
    <span id="text1">ë´‰ì¸ëœ ë¬¸ì–‘</span>
  </div>
  <div class="slot white" onclick="selectSlot(2)">
    <img src="baekho.png" alt="ë°±í˜¸">
    <span id="text2">ë´‰ì¸ëœ ë¬¸ì–‘</span>
  </div>
  <div class="slot blue" onclick="selectSlot(3)">
    <img src="cheongryong.png" alt="ì²­ë£¡">
    <span id="text3">ë´‰ì¸ëœ ë¬¸ì–‘</span>
  </div>
  <div class="slot green" onclick="selectSlot(4)">
    <img src="hyeonmu.png" alt="í˜„ë¬´">
    <span id="text4">ë´‰ì¸ëœ ë¬¸ì–‘</span>
  </div>

  <!-- ê°ì¸ ë²„íŠ¼ -->
  <div class="engraving-buttons">
    <!-- âœ… ì´ê±´ ë‚¨ê²¨ì•¼ í•¨ -->
    <div class="tab-buttons">
      <button onclick="switchTab('flat')">ì•ê°</button>
      <button onclick="switchTab('add')">ë’·ê°</button>
      <button onclick="switchTab('hwangryong')">í™©ë£¡</button>
      <button onclick="switchTab('transcend')">ì´ˆì›”</button>
    </div>

    <!-- ì•ê° -->
    <div id="tab-flat" class="engraving-tab">
      <button onclick="applyFlat('ì‹ ')">ë„ê¹¨ë¹„ë°©ì–´êµ¬ê´€í†µ'ì‹ </button>
      <button onclick="applyFlat('ë³´ë¬¼')">ë³´ë¬¼ë„ê¹¨ë¹„ë°©ì–´êµ¬ê´€í†µ</button>
      <button onclick="applyFlat('ì „ì„¤')">ì „ì„¤ë„ê¹¨ë¹„ë°©ì–´êµ¬ê´€í†µ</button>
    </div>

    <!-- ë’·ê° -->
    <div id="tab-add" class="engraving-tab" style="display:none;">
      <!-- ì‹ ìˆ˜ ë’·ê° ì¶”ê°€ -->
      <button onclick="applyAdd('[ì‹ ìˆ˜]1.8')">[ì‹ ìˆ˜]ê³ ê¸‰ë°©ì–´êµ¬ê´€í†µì¶”ê°€ê°ì¸ë¹„ì„œ(+1.8%)</button>
      <button onclick="applyAdd('[ì‹ ìˆ˜]1.5')">[ì‹ ìˆ˜]ê³ ê¸‰ë°©ì–´êµ¬ê´€í†µì¶”ê°€ê°ì¸ë¹„ì„œ(+1.5%)</button>
      <button onclick="applyAdd('[ì‹ ìˆ˜]1.0')">[ì‹ ìˆ˜]ê³ ê¸‰ë°©ì–´êµ¬ê´€í†µì¶”ê°€ê°ì¸ë¹„ì„œ(+1.0%)</button>
      <button onclick="applyAdd('ë„ê¹¨ë¹„')">ë„ê¹¨ë¹„ì¶”ê°€ê°ì¸ë¹„ì„œ</button>
      <button onclick="applyAdd('ë³´ë¬¼')">ë³´ë¬¼ë„ê¹¨ë¹„ì¶”ê°€ê°ì¸ë¹„ì„œ</button>
      <button onclick="applyAdd('ì „ì„¤')">ì „ì„¤ë„ê¹¨ë¹„ì¶”ê°€ê°ì¸ë¹„ì„œ</button>
    </div>

    <!-- í™©ë£¡ -->
    <div id="tab-hwangryong" class="engraving-tab" style="display:none;">
      <button onclick="applyHwangryongCopy('ì¼ë°˜')">[í™©ë£¡] ì ì¬ë ¥ê°ì¸ë¹„ì„œ</button>
      <button onclick="applyHwangryongCopy('í¬ê·€')">[í™©ë£¡] í¬ê·€ì ì¬ë ¥ê°ì¸ë¹„ì„œ</button>
    </div>

    <!-- ì´ˆì›” -->
    <div id="tab-transcend" class="engraving-tab" style="display:none;">
      <button onclick="applyTranscend()">ì´ˆì›”ê°ì¸ë¹„ì„œ ì‚¬ìš©</button>
    </div>

    <div class="log" id="log">ìŠ¬ë¡¯ì„ ì„ íƒí•œ í›„ ë¹„ì„œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</div>
    <div class="log" id="usageSummary" style="margin-top:4px;"></div>

  </div>
</div>

<!-- ì´í™íŠ¸ í‘œì‹œìš© ì´ë¯¸ì§€ (ì²˜ìŒì—” ì•ˆë³´ì„) -->
<img id="effectImage" src="" style="position: absolute; left: 230px; top: 100px; width: 180px; display: none; pointer-events: none; z-index: 999;">

<!-- ì‚¬ìš©ëŸ‰ ìš”ì•½ í…Œì´ë¸” í‘œì‹œ -->
<div id="usageTable" style="
  margin: 8px auto; 
  width: 663px;
  background: rgba(0, 0, 0, 0.7);
  color: #fff;
  padding: 10px;
  border: 1px solid #444;
  border-radius: 6px;
  font-size: 12px;
  white-space: pre-line;
"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<button id="kakaoShareBtn" style="
background: #fae100;
color: #000;
padding: 6px 12px;
border: none;
border-radius: 6px;
font-weight: bold;
cursor: pointer;
margin: 6px auto;
display: block;
">ğŸ’¬ ê°ì¸ ìë‘í•˜ê¸° (ë¯¸ì§€ì›)</button>

<script>
  const totalAddUsage = {
    "ë„ê¹¨ë¹„": 0,
    "ë³´ë¬¼": 0,
    "ì „ì„¤": 0,
    "[ì‹ ìˆ˜]1.8": 0,
    "[ì‹ ìˆ˜]1.5": 0,
    "[ì‹ ìˆ˜]1.0": 0
  };

    const slotAddUsage = Array.from({ length: 5 }, () => ({
    "ë„ê¹¨ë¹„": 0,
    "ë³´ë¬¼": 0,
    "ì „ì„¤": 0,
    "[ì‹ ìˆ˜]1.8": 0,
    "[ì‹ ìˆ˜]1.5": 0,
    "[ì‹ ìˆ˜]1.0": 0
  }));


  const slotNames = ["í™©ë£¡", "ì£¼ì‘", "ë°±í˜¸", "ì²­ë£¡", "í˜„ë¬´"];
  const slotStates = Array.from({ length: 5 }, () => ({ flat: null }));
  let selectedSlot = null;

  function selectSlot(index) {
    document.querySelectorAll('.slot').forEach(el => el.classList.remove('selected'));
    selectedSlot = index;
    document.querySelectorAll('.slot')[index].classList.add('selected');
    updateLog(`${slotNames[index]} ìŠ¬ë¡¯ ì„ íƒë¨`);
  }

  const totalUsage = {
  "ì‹ ": 0,
  "ë³´ë¬¼": 0,
  "ì „ì„¤": 0
  };

  const slotUsage = Array.from({ length: 5 }, () => ({
    "ì‹ ": 0,
    "ë³´ë¬¼": 0,
    "ì „ì„¤": 0
  }));
  
  const hwangryongUsage = {
  "ì¼ë°˜": 0,
  "í¬ê·€": 0
};

const hwangryongSlotUsage = {
  "ì¼ë°˜": 0,
  "í¬ê·€": 0
};


function switchTab(tab) {
  // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
  document.querySelectorAll('.engraving-tab').forEach(div => div.style.display = 'none');

  // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
  document.querySelectorAll('.tab-buttons button').forEach(btn => btn.classList.remove('active'));

  // ì„ íƒí•œ íƒ­ ë³´ì´ê¸°
  document.getElementById(`tab-${tab}`).style.display = 'block';

  // ì„ íƒí•œ ë²„íŠ¼ í™œì„±í™”
  const idx = {flat: 0, add: 1, hwangryong: 2, transcend: 3}[tab];
  document.querySelectorAll('.tab-buttons button')[idx].classList.add('active');
}



  function roundToOneDecimal(value) {
  return Math.round(value * 10) / 10;
}

function applyFlat(type) {
  if (selectedSlot === null) return updateLog("ë¨¼ì € ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì„¸ìš”.");

  if (selectedSlot === 0) return updateLog("í™©ë£¡ ìŠ¬ë¡¯ì—ëŠ” ì•ê° ë¹„ì„œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

  const state = slotStates[selectedSlot];

  // âœ… ë’·ê°ì´ ì´ë¯¸ ë°•í˜€ ìˆìœ¼ë©´ ì•ê° ë³€ê²½ ê¸ˆì§€
  if (state.add !== undefined) {
    return updateLog("ë’·ê°ì´ ì´ë¯¸ ê°ì¸ë˜ì–´ ìˆì–´ ì•ê°ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }

  const current = state.flat;
  if (current !== null && current >= 3.70) {
    return updateLog("ì•ê° ìˆ˜ì¹˜ê°€ ìµœëŒ€ì…ë‹ˆë‹¤. ë” ì´ìƒ ê°ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }

  if (!spend(priceTable.flat[type])) return;

  const flat = getFlatValue(type);
  state.flat = flat;

  totalUsage[type]++;
  slotUsage[selectedSlot][type]++;

  updateSlotDisplay(selectedSlot);
  updateLog(`${slotNames[selectedSlot]} ìŠ¬ë¡¯ì— ${type} ë¹„ì„œë¡œ ì•ê° +${flat}% ì ìš©ë¨`);
  updateUsageSummary();
  showEffect("flat");
  updateTotalPenetrationUI();
}




function applyAdd(type) {
  if (selectedSlot === null) return updateLog("ë¨¼ì € ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì„¸ìš”.");
  if (selectedSlot === 0) return updateLog("í™©ë£¡ ìŠ¬ë¡¯ì—ëŠ” ë’·ê°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

  const state = slotStates[selectedSlot];
  if (state.flat === null) return updateLog("ì•ê°ì´ ì—†ëŠ” ìŠ¬ë¡¯ì—ëŠ” ë’·ê°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

  const currentAdd = state.add ?? 0;

  // ì‹ ìˆ˜ ìµœëŒ€ê° ë°©ì§€
  if (["[ì‹ ìˆ˜]1.8", "[ì‹ ìˆ˜]1.5", "[ì‹ ìˆ˜]1.0"].includes(type) && currentAdd >= 1.8) {
    return updateLog("ì´ë¯¸ ìµœëŒ€ ìˆ˜ì¹˜ì˜ ë’·ê°ì´ ê°ì¸ë˜ì–´ ìˆì–´ ì‹ ìˆ˜ì¶”ê° ë¹„ì„œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }

  if (currentAdd >= 1.90) return updateLog("ë’·ê° ìˆ˜ì¹˜ê°€ ìµœëŒ€ì…ë‹ˆë‹¤. ë” ì´ìƒ ê°ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

  let addValue = null;
  let success = true;

  if (["[ì‹ ìˆ˜]1.8", "[ì‹ ìˆ˜]1.5", "[ì‹ ìˆ˜]1.0"].includes(type)) {
    if (!spend(priceTable.add[type])) return;

    const successRate = {
      "[ì‹ ìˆ˜]1.8": 0.01,
      "[ì‹ ìˆ˜]1.5": 0.05,
      "[ì‹ ìˆ˜]1.0": 0.10
    }[type];

    success = Math.random() < successRate;
    addValue = parseFloat(type.match(/\d\.\d/)[0]);

    // âœ… ì‹¤íŒ¨í•´ë„ ì¹´ìš´íŠ¸
    totalAddUsage[type] = (totalAddUsage[type] || 0) + 1;
    slotAddUsage[selectedSlot][type] = (slotAddUsage[selectedSlot][type] || 0) + 1;

    if (!success) {
      updateLog(`âŒ ${slotNames[selectedSlot]} ìŠ¬ë¡¯ì— ${type} ì‹¤íŒ¨!`);
      updateUsageSummary();
      return;
    }
  } else {
    if (!spend(priceTable.add[type])) return;
    addValue = getAddValue(type, state.flat);
    totalAddUsage[type]++;
    slotAddUsage[selectedSlot][type]++;
  }

  state.add = addValue;
  updateSlotDisplay(selectedSlot);
  updateLog(`âœ… ${slotNames[selectedSlot]} ìŠ¬ë¡¯ì— ${type} ì„±ê³µ! ë’·ê° +${addValue}% ì ìš©ë¨`);
  updateUsageSummary();
  showEffect("add");
  updateTotalPenetrationUI();
}



  function clearEngraving() {
    if (selectedSlot === null) return updateLog("ë¨¼ì € ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì„¸ìš”.");

    slotStates[selectedSlot].flat = null;
    updateSlotDisplay(selectedSlot);
    updateLog(`${slotNames[selectedSlot]} ìŠ¬ë¡¯ì˜ ê°ì¸ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  }

  function getTranscendAddColor(level) {
  if (level === 3) return '#d0a9f5';  // ì—°ë³´ë¼
  if (level === 2) return '#ff6a00';  // ì°ì£¼í™©
  if (level === 1) return '#e0b84a';  // í™©í† +ë…¸ë‘
  return '#ffffff';
}

function updateSlotDisplay(index) {
  const state = slotStates[index];
  const textEl = document.getElementById(`text${index}`);

  if (state.flat !== null && state.add !== undefined) {
    const flat = state.flat.toFixed(2);
    const add = state.add.toFixed(1);

    const level = state.transcendLevel || 0;
    const color = level > 0 ? getTranscendAddColor(level) : '#ffff00';

    let text = `ã€€ã€€ë°©ì–´êµ¬ê´€í†µ\n+${flat}%[x] <span style="color:${color}">+${add}%[x]</span>`;

    if (level > 0) {
      text += `<br><span style="color:${color}">(ã€€ì´ˆì›”ê°•í™” +${level}ê°•ã€€)</span>`;
    }

    textEl.innerHTML = text;
  } else if (state.flat !== null) {
    textEl.innerText = `ã€€ã€€ë°©ì–´êµ¬ê´€í†µ\n+${state.flat.toFixed(2)}%[x]`;
  } else {
    textEl.innerText = `ã€€ã€€ã€€ë´‰ì¸ëœ ë¬¸ì–‘`;
  }
}

function showEffect(type) {
  const effect = document.createElement('img');
  effect.src = `effects/effect_${type}.gif`; // flat, add, transcend ì¤‘ í•˜ë‚˜
  effect.className = 'effect-gif';
  
  // ìŠ¬ë¡¯ ìœ„ì¹˜ ì¤‘ì•™ì— ë§ì¶”ê¸°
  const slot = document.querySelectorAll('.slot')[selectedSlot];
  const rect = slot.getBoundingClientRect();

  effect.style.position = 'absolute';
  effect.style.left = `${rect.left + rect.width / 2}px`;
  effect.style.top = `${rect.top + rect.height / 2}px`;
  effect.style.transform = 'translate(-50%, -50%)';
  effect.style.pointerEvents = 'none';
  effect.style.zIndex = '999';

  document.body.appendChild(effect);

  setTimeout(() => {
    effect.remove();
  }, 800); // ìë™ ì œê±°
}


  function updateLog(msg) {
    document.getElementById("log").innerText = msg;
  }

  function updateUsageSummary() {
  let html = `<b>ğŸ“¦ ì´ ì‚¬ìš©ëŸ‰</b><br>`;
  html += `<ul style="margin-top:4px; padding-left:18px;">`;
  html += `<li>ì•ê° - ì‹ : ${totalUsage["ì‹ "]}ì¥, ë³´ë¬¼: ${totalUsage["ë³´ë¬¼"]}ì¥, ì „ì„¤: ${totalUsage["ì „ì„¤"]}ì¥</li>`;
  html += `<li>ë’·ê° - ë„ê¹¨ë¹„: ${totalAddUsage["ë„ê¹¨ë¹„"]}ì¥, ë³´ë¬¼: ${totalAddUsage["ë³´ë¬¼"]}ì¥, ì „ì„¤: ${totalAddUsage["ì „ì„¤"]}ì¥</li>`;
  html += `<li>ë’·ê° - [ì‹ ìˆ˜]1.8%: ${totalAddUsage["[ì‹ ìˆ˜]1.8"]}ì¥, 1.5%: ${totalAddUsage["[ì‹ ìˆ˜]1.5"]}ì¥, 1.0%: ${totalAddUsage["[ì‹ ìˆ˜]1.0"]}ì¥</li>`;
  html += `<li>í™©ë£¡ - ì¼ë°˜: ${hwangryongUsage["ì¼ë°˜"]}ì¥, í¬ê·€: ${hwangryongUsage["í¬ê·€"]}ì¥</li>`;
  html += `</ul>`;

  html += `<b>ğŸ“Œ ìŠ¬ë¡¯ë³„ ì‚¬ìš©ëŸ‰</b><br>`;
  html += `<table style="width:100%; border-collapse: collapse; margin-top: 5px;">`;
  html += `<thead><tr style="background:#222;"><th style="padding:2px;">ìŠ¬ë¡¯</th><th>ì•ê°</th><th>ë’·ê°</th><th>í™©ë£¡</th></tr></thead>`;
  html += `<tbody>`;

  for (let i = 0; i < 5; i++) {
    const name = slotNames[i];
    const flatStr = Object.entries(slotUsage[i]).filter(([_, v]) => v > 0)
        .map(([k, v]) => `'${k}': ${v}ì¥`).join(', ') || '-';

        const addStr = Object.entries(slotAddUsage[i]).filter(([_, v]) => v > 0)
        .map(([k, v]) => `${k}: ${v}ì¥`).join(', ') || '-';

    const hwangStr = (i === 0)
      ? Object.entries(hwangryongSlotUsage).filter(([_, v]) => v > 0)
        .map(([k, v]) => `${k}: ${v}ì¥`).join(', ') || '-'
      : '-';

    html += `<tr style="text-align:center;"><td>${name}</td><td>${flatStr}</td><td>${addStr}</td><td>${hwangStr}</td></tr>`;
  }

  html += `</tbody></table>`;

  document.getElementById("usageTable").innerHTML = html;
}



function applyHwangryongCopy(type) {
  if (selectedSlot !== 0) return updateLog("í™©ë£¡ ìŠ¬ë¡¯ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");

  const state = slotStates[0];

  if (state.flat !== null) {
    return updateLog("í™©ë£¡ ìŠ¬ë¡¯ì— ì´ë¯¸ ì ì¬ë ¥ì´ ê°ì¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.");
  }

  // ğŸ’¸ ë¹„ìš© ì°¨ê° ë¨¼ì €
  if (!spend(priceTable.hwangryong[type])) return;

  const successRate = type === 'í¬ê·€' ? 5 : 3;
  const success = Math.random() * 100 < successRate;

  hwangryongUsage[type]++;
  hwangryongSlotUsage[type]++;

  updateUsageSummary();

  if (!success) {
    updateLog(`[í™©ë£¡] ${type}ì ì¬ë ¥ê°ì¸ë¹„ì„œ ì‹¤íŒ¨!`);
    return;
  }

  const candidates = [1, 2, 3, 4]; // ì£¼ì‘~í˜„ë¬´
  const chosen = candidates[Math.floor(Math.random() * candidates.length)];
  const source = slotStates[chosen];

  if (!source.flat) {
    updateLog(`[í™©ë£¡] ì„ íƒëœ ìŠ¬ë¡¯(${slotNames[chosen]})ì— ì•ê°ì´ ì—†ì–´ ë³µì‚¬ ì‹¤íŒ¨`);
    return;
  }

  slotStates[0].flat = source.flat;
  slotStates[0].add = source.add ?? undefined;

  updateSlotDisplay(0);
  updateLog(`[í™©ë£¡] ${type}ì ì¬ë ¥ê°ì¸ë¹„ì„œ ì„±ê³µ! ${slotNames[chosen]}ì˜ ê°ì¸ì„ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.`);
  updateTotalPenetrationUI();
}


  function applyTranscend() {
  if (selectedSlot === null) return updateLog("ìŠ¬ë¡¯ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");
  const state = slotStates[selectedSlot];

  if (!state.flat || !state.add) return updateLog("ì•ê°ê³¼ ë’·ê°ì´ ëª¨ë‘ ìˆì–´ì•¼ ì´ˆì›”ê°•í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
  if (state.add < state.flat * 0.3) return updateLog("ë’·ê° ìˆ˜ì¹˜ê°€ ì•ê°ì˜ 30% ì´ìƒì´ì–´ì•¼ ì´ˆì›”ê°•í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");

  if (!state.transcendLevel) state.transcendLevel = 0;
  if (state.transcendLevel >= 3) return updateLog("ì´ˆì›”ê°•í™”ëŠ” ìŠ¬ë¡¯ë‹¹ ìµœëŒ€ 3ê°•ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");

  // ğŸ’¸ ì—¬ê¸° ì¶”ê°€!
  if (!spend(priceTable.transcend)) return;

  const chances = [
    { rate: 60, ratio: 0.10 },
    { rate: 20, ratio: 0.20 },
    { rate: 12, ratio: 0.30 },
    { rate: 6,  ratio: 0.40 },
    { rate: 2,  ratio: 0.50 }
  ];

  const rand = Math.random() * 100;
  let sum = 0;
  let chosen = chances[chances.length - 1];
  for (let i = 0; i < chances.length; i++) {
    sum += chances[i].rate;
    if (rand <= sum) {
      chosen = chances[i];
      break;
    }
  }

  // ì•ê°ì˜ X% ê³„ì‚°
  let increment = state.flat * chosen.ratio;
  increment = increment < 0.01 ? 0.01 : Math.round(increment * 100) / 100; // ìµœì†Œ 0.01%, ë°˜ì˜¬ë¦¼

  // ëˆ„ì  ì¦ê°€
  state.add += increment;
  state.transcendLevel++;

  updateSlotDisplay(selectedSlot);
  updateLog(`${slotNames[selectedSlot]} ìŠ¬ë¡¯ ì´ˆì›”ê°•í™” +${state.transcendLevel}ê°• ì„±ê³µ! (ì•ê°ì˜ ${Math.round(chosen.ratio * 100)}%ì¸ +${increment.toFixed(2)}% ëˆ„ì ë¨)`);
  updateUsageSummary();
  showEffect("transcend");
  updateTotalPenetrationUI();
}




  function getFlatValue(type) {
  const table = {
    "ì‹ ": [
      { p: 68.00, v: 0.70 },
      { p: 21.00, v: 1.70 },
      { p: 8.00, v: 2.80 },
      { p: 3.00, v: 3.70 },
    ],
    "ë³´ë¬¼": [
      { p: 55.00, v: 0.70 },
      { p: 24.00, v: 1.50 },
      { p: 12.00, v: 2.20 },
      { p: 7.00,  v: 3.00 },
      { p: 2.00,  v: 3.80 },
    ],
    "ì „ì„¤": [
      { p: 40.00, v: 0.90 },
      { p: 29.00, v: 1.70 },
      { p: 20.00, v: 2.40 },
      { p: 9.50,  v: 3.20 },
      { p: 1.50,  v: 4.00 },
    ]
  };

  const rand = Math.random() * 100;
  let sum = 0;
  for (let i = 0; i < table[type].length; i++) {
    sum += table[type][i].p;
    if (rand <= sum) return table[type][i].v; // ìˆ«ì ê·¸ëŒ€ë¡œ ë°˜í™˜!!!
  }
  return table[type][table[type].length - 1].v;
}


function getAddValue(type, flatValue) {
  const table = {
    "ì „ì„¤": [
      { rate: 40.0, ratio: 0.10 },
      { rate: 40.0, ratio: 0.20 },
      { rate: 15.0, ratio: 0.25 },
      { rate: 5.0,  ratio: 0.50 },
    ],
    "ë³´ë¬¼": [
      { rate: 60.0, ratio: 0.10 },
      { rate: 30.0, ratio: 0.20 },
      { rate: 7.0,  ratio: 0.25 },
      { rate: 3.0,  ratio: 0.50 },
    ],
    "ë„ê¹¨ë¹„": [
      { rate: 80.0, ratio: 0.10 },
      { rate: 15.0, ratio: 0.20 },
      { rate: 4.0,  ratio: 0.25 },
      { rate: 1.0,  ratio: 0.50 },
    ]
  };

  const list = table[type];
  const rand = Math.random() * 100;
  let sum = 0;
  for (let i = 0; i < list.length; i++) {
    sum += list[i].rate;
    if (rand <= sum) return roundToOneDecimal(flatValue * list[i].ratio);
  }
  return roundToOneDecimal(flatValue * list[list.length - 1].ratio);
}

// ì´ˆê¸° ì†Œì§€ê¸ˆ
let gold = 50000000000; // 500ì–µ ì „
const initialGold = gold;

const priceTable = {
  flat: { "ì‹ ": 3600000, "ë³´ë¬¼": 6000000, "ì „ì„¤": 25000000 },
  add:  { "ë„ê¹¨ë¹„": 6400000, "ë³´ë¬¼": 18000000, "ì „ì„¤": 35000000,
    "[ì‹ ìˆ˜]1.8": 4600000,
    "[ì‹ ìˆ˜]1.5": 6000000,
    "[ì‹ ìˆ˜]1.0": 3500000 },
  hwangryong: { "ì¼ë°˜": 80000000, "í¬ê·€": 150000000 },
  transcend: 700000000
};

// ğŸ’¸ ì†Œì§€ê¸ˆ ì°¨ê° í•¨ìˆ˜
function spend(amount) {
  if (gold < amount) {
    updateLog("ğŸ’¸ ì†Œì§€ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
    return false;
  }
  gold -= amount;
  updateGoldUI();
  return true;
}

// ğŸ’¸ ìƒë‹¨ ì†Œì§€ê¸ˆ í‘œì‹œ ê°±ì‹ 
function updateGoldUI() {
  const used = initialGold - gold;
  const cash = Math.round((used / 100000000) * 45000);
  document.getElementById("goldStatus").innerText =
    `ğŸ’° ì‚¬ìš© ê¸ˆì „: ${used.toLocaleString()}ì „ | ğŸ’´ í™˜ì‚°: ì•½ ${cash.toLocaleString()}ì› | ë‚¨ì€ ê¸ˆì „: ${gold.toLocaleString()}ì „`;
}

function togglePriceConfig() {
  const div = document.getElementById('priceConfig');
  const btn = document.getElementById('priceToggle');
  if (div.style.display === 'none') {
    div.style.display = 'block';
    btn.innerText = 'ğŸ’¸ ë¹„ì„œ ê°€ê²© ì„¤ì • ì ‘ê¸°';
  } else {
    div.style.display = 'none';
    btn.innerText = 'ğŸ’¸ ë¹„ì„œ ê°€ê²© ì„¤ì • í¼ì¹˜ê¸°';
  }
}

function applyNewPrices() {
  priceTable.flat["ì‹ "] = +document.getElementById("priceFlatì‹ ").value.replace(/,/g, '');
  priceTable.flat["ë³´ë¬¼"] = +document.getElementById("priceFlatë³´ë¬¼").value.replace(/,/g, '');
  priceTable.flat["ì „ì„¤"] = +document.getElementById("priceFlatì „ì„¤").value.replace(/,/g, '');
  priceTable.add["ë„ê¹¨ë¹„"] = +document.getElementById("priceAddë„ê¹¨ë¹„").value.replace(/,/g, '');
  priceTable.add["ë³´ë¬¼"] = +document.getElementById("priceAddë³´ë¬¼").value.replace(/,/g, '');
  priceTable.add["ì „ì„¤"] = +document.getElementById("priceAddì „ì„¤").value.replace(/,/g, '');
  priceTable.add["[ì‹ ìˆ˜]1.8"] = +document.getElementById("priceAdd[ì‹ ìˆ˜]1.8").value.replace(/,/g, '');
  priceTable.add["[ì‹ ìˆ˜]1.5"] = +document.getElementById("priceAdd[ì‹ ìˆ˜]1.5").value.replace(/,/g, '');
  priceTable.add["[ì‹ ìˆ˜]1.0"] = +document.getElementById("priceAdd[ì‹ ìˆ˜]1.0").value.replace(/,/g, '');
  priceTable.hwangryong["ì¼ë°˜"] = +document.getElementById("priceHwangì¼ë°˜").value.replace(/,/g, '');
  priceTable.hwangryong["í¬ê·€"] = +document.getElementById("priceHwangí¬ê·€").value.replace(/,/g, '');
  priceTable.transcend = +document.getElementById("priceTranscend").value.replace(/,/g, '');
  alert("ğŸ’° ê°€ê²©ì´ ì„±ê³µì ìœ¼ë¡œ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤!");
}

function togglePricePanel() {
  const panel = document.getElementById('pricePanel');
  panel.style.display = (panel.style.display === 'none') ? 'block' : 'none';
}

function formatWithComma(input) {
  const value = input.value.replace(/,/g, '');
  if (isNaN(value)) return;
  input.value = Number(value).toLocaleString();
}

document.getElementById("kakaoShareBtn").addEventListener("click", async () => {
  const target = document.body; // ì „ì²´ UI ìº¡ì²˜
  try {
    const canvas = await html2canvas(target, {
      useCORS: true,
      width: 663,
      height: 750, // ì—¬ìœ  ìˆê²Œ ì„¤ì •
      scale: window.devicePixelRatio || 1
    });

    canvas.toBlob(async (blob) => {
      if (!navigator.clipboard) {
        alert("í´ë¦½ë³´ë“œ ë³µì‚¬ê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
        return;
      }

      await navigator.clipboard.write([
        new ClipboardItem({ [blob.type]: blob })
      ]);

      alert("ğŸ“¸ ì´ë¯¸ì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”!");

      const message = `ğŸ›¡ï¸âš”ï¸ ë°©ê´€ ${calculateTotalPenetration()}ê°ì¸ì„ ë§Œë“¤ì—ˆì–´ìš”!\n` +
        "https://ekdms05.github.io/Engraving-Simulator/\nê°ì¸ì‹œë®¬ë ˆì´í„° - ì „ì¿ ë¦°@ì—°";
      await navigator.clipboard.writeText(message);
    });

  } catch (e) {
    alert("ìŠ¤í¬ë¦°ìƒ· ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    console.error(e);
  }
});


function calculateTotalPenetration() {
  let total = 0;
  for (const state of slotStates) {
    total += (state.flat ?? 0) + (state.add ?? 0);
  }
  return Math.round(total * 10 * 10) / 10; // 1ìë¦¬ ë°˜ì˜¬ë¦¼
}

function updateTotalPenetrationUI() {
  const total = calculateTotalPenetration();
  document.getElementById("totalPenetrationDisplay").innerText =
    `ğŸ›¡ï¸âš”ï¸ ì´ ë°©ì–´êµ¬ê´€í†µ ìˆ˜ì¹˜: ${total.toLocaleString()}`;
}


document.addEventListener('DOMContentLoaded', () => {
  switchTab('flat');
  updateUsageSummary();
  updateGoldUI();
  document.querySelectorAll('#priceConfig input').forEach(input => formatWithComma(input));
});


</script>
</body>
</html>
